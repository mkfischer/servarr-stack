# Servarr Stack - Private Network Configuration
# Platform: Ubuntu with Podman (developed on macOS)
# NFS Mount: 192.168.50.186:/mnt/array1/yoho â†’ /mnt/media
# 
# Active Services:
#   - Media Management: Sonarr, Radarr, Bazarr, Prowlarr
#   - Download Client: qBittorrent
#   - Support: Unpackerr, qBitManage
#   - Dashboard: Homepage
#
# Setup: Run ./manage.sh setup for initial configuration
# Management: Use ./manage.sh for all container operations

services:
  # Dashboard
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    userns_mode: keep-id
    environment:
      PUID: 1001
      PGID: 1001
      TZ: America/Denver
      HOMEPAGE_VAR_HOST: 0.0.0.0  # Allow connections from any IP
      HOMEPAGE_ALLOWED_HOSTS: "*"  # Allow requests from any host/port
    volumes:
      - /srv/apps/homepage:/app/config
      # - /var/run/docker.sock:/var/run/docker.sock:ro # Disabled for Podman
    ports:
      - "3000:3000"
    networks:
      media_net:
        ipv4_address: 172.20.0.2
    restart: unless-stopped

  # Media Automation Services
  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    userns_mode: keep-id
    environment:
      PUID: 1001
      PGID: 1001
      TZ: America/Denver
    volumes:
      - /srv/apps/sonarr:/config
      - /mnt/media/downloads:/downloads
      - /mnt/media/library/tv:/tv
      - /mnt/media/library/anime-series:/anime
    ports:
      - "8989:8989"
    networks:
      media_net:
        ipv4_address: 172.20.0.11
    restart: unless-stopped

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    userns_mode: keep-id
    environment:
      PUID: 1001
      PGID: 1001
      TZ: America/Denver
    volumes:
      - /srv/apps/radarr:/config
      - /mnt/media/downloads:/downloads
      - /mnt/media/library/movies:/movies
      - /mnt/media/library/anime-movies:/anime
    ports:
      - "7878:7878"
    networks:
      media_net:
        ipv4_address: 172.20.0.12
    restart: unless-stopped

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    userns_mode: keep-id
    environment:
      PUID: 1001
      PGID: 1001
      TZ: America/Denver
    volumes:
      - /srv/apps/bazarr:/config
      - /mnt/media/library/movies:/movies
      - /mnt/media/library/tv:/tv
      - /mnt/media/library/anime-series:/anime-series
      - /mnt/media/library/anime-movies:/anime-movies
    ports:
      - "6767:6767"
    networks:
      media_net:
        ipv4_address: 172.20.0.13
    restart: unless-stopped

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    userns_mode: keep-id
    environment:
      PUID: 1001
      PGID: 1001
      TZ: America/Denver
    volumes:
      - /srv/apps/prowlarr:/config
    ports:
      - "9696:9696"
    networks:
      media_net:
        ipv4_address: 172.20.0.14
    restart: unless-stopped

  # Download Clients
  qbittorrent:
    image: docker.io/qbittorrentofficial/qbittorrent-nox:latest
    container_name: qbittorrent
    userns_mode: keep-id
    environment:
      PUID: 1001
      PGID: 1001
      TZ: America/Denver
      WEBUI_PORT: 8080
      TORRENTING_PORT: 6881
    volumes:
      - /srv/apps/qbittorrent:/config
      - /mnt/media/downloads:/downloads
    ports:
      - "8080:8080" # Web UI
      - "6881:6881" # Torrent port
      - "6881:6881/udp" # Torrent port UDP
    networks:
      media_net:
        ipv4_address: 172.20.0.16
    restart: unless-stopped

  # Support Services
  unpackerr:
    image: ghcr.io/hotio/unpackerr
    container_name: unpackerr
    userns_mode: keep-id
    environment:
      PUID: 1001
      PGID: 1001
      UMASK: 002
      TZ: America/Denver
    volumes:
      - /srv/apps/unpackerr:/config
      - /mnt/media/downloads:/data
    networks:
      media_net:
        ipv4_address: 172.20.0.4
    restart: unless-stopped

  qbitmanage:
    image: ghcr.io/hotio/qbitmanage
    container_name: qbitmanage
    userns_mode: keep-id
    environment:
      PUID: 1001
      PGID: 1001
      UMASK: 002
      TZ: America/Denver
    volumes:
      - /srv/apps/qbitmanage:/config
      - /mnt/media/downloads:/downloads
    networks:
      media_net:
        ipv4_address: 172.20.0.7
    restart: unless-stopped
    depends_on:
      - qbittorrent

  # Container Management:
  # Use ./manage.sh update to update containers
  # Or manually: podman pull <image> && podman-compose up -d <service>

networks:
  media_net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/24
